<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
<mapper namespace="com.saltedfish.mapper.security.ResourcesMapper">
 
 <!-- 根据用户ID查询用户的权限 -->
 <select id="getResourcesByUserId" parameterType="string" resultType="com.saltedfish.entity.security.SysResources" >
    SELECT 
		res.RES_ID id,
		res.RES_NAME name,
		res.RES_PARENT_ID parentId,
		res.RES_KEY  resKey,
		res.RES_URL resUrl,
		res.RES_LEVEL level,
		res.RES_DES  description 
	FROM SYS_USERS  u 
		LEFT JOIN SYS_USERS_ROLES ur ON u.USER_ID = ur.USER_ID
		LEFT JOIN SYS_ROLES  r ON ur.ROLE_ID = r.ROLE_ID
		LEFT JOIN SYS_ROLES_RESOURCES rr ON  rr.ROLE_ID = r.ROLE_ID
		LEFT JOIN SYS_RESOURCES res ON res.RES_ID = rr.RES_ID 
	WHERE u.USER_ID = #{value} 
	</select>
	
	
	<!-- 加载所有的资源 -->
	<select id="loadTreeDataAll" resultType="com.saltedfish.dto.security.ResourceJsonDTO">
		SELECT 
		res.RES_ID id,
		res.RES_NAME name,
		res.RES_PARENT_ID pId,
		res.RES_TYPE type
		FROM SYS_RESOURCES res
	</select>
	
	<!-- 根据角色加载权限 -->
	<select id="loadTreeDataByRoleId"  parameterType="int"  resultType="com.saltedfish.dto.security.ResourceJsonDTO">
		SELECT 
			res.RES_ID id,
			res.RES_NAME name,
			res.RES_PARENT_ID pId,
			res.RES_TYPE type
		FROM SYS_ROLES role 
			LEFT JOIN SYS_ROLES_RESOURCES rr ON role.ROLE_ID = rr.ROLE_ID 
			LEFT JOIN SYS_RESOURCES  res ON res.RES_ID  = rr.RES_ID
		WHERE role.ROLE_ID = #{value}
	</select>
</mapper> 