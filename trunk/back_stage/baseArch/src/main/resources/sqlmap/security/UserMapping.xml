<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
<mapper namespace="com.saltedfish.mapper.security.UserMapper">
    <select id="getUsersCount" resultType="int">
    	select count(*) from SYS_USERS
    </select>
    
    <!-- 根据登录名查询用户 -->
    <select id="selectSysUserByName" parameterType="String" resultType="com.saltedfish.entity.security.SysUsers">
    SELECT 
    	USER_ID userId ,
    	USER_NAME username,
    	NAME name,
    	PASSWORD password,
    	DT_CREATE  dtCreate ,
    	LAST_LOGIN lastLogin,
    	DEADLINE deadline,
    	LOGIN_IP loginIp, 
    	V_QZJGID VQzjgid,
    	V_QZJGMC VQzjgmc,
    	DEP_ID depId,
    	DEP_NAME depName , 
    	ENABLED enabled  , 
    	ACCOUNT_NON_EXPIRED accountNonExpired , 
    	ACCOUNT_NON_LOCKED accountNonLocked ,
    	CREDENTIALS_NON_EXPIRED credentialsNonExpired
	FROM SYS_USERS
		WHERE NAME=#{value}
    </select>
    <sql id="queryUsersConditions">
    	<if test="loginName !=null and loginName !=''">
    		AND NAME LIKE  '%${loginName}%'
    	</if>
    	<if test="beginDate !=null and beginDate !=''">
    		AND DT_CREATE > #{beginDate}
    	</if>
    	<if test="endDate !=null and endDate !=''">
    		AND #{endDate} >  DT_CREATE 
    	</if>
    </sql>
    
    
    <!-- 查询所有用户 -->
    <select id="queryUsers"  parameterType="com.saltedfish.cmd.admin.AdminListQueryCmd"  resultType="com.saltedfish.entity.security.SysUsers">
		SELECT 
    	USER_ID userId ,
    	USER_NAME username,
    	NAME name,
    	PASSWORD password,
    	DT_CREATE  dtCreate ,
    	LAST_LOGIN lastLogin,
    	DEADLINE deadline,
    	LOGIN_IP loginIp, 
    	V_QZJGID VQzjgid,
    	V_QZJGMC VQzjgmc,
    	DEP_ID depId,
    	DEP_NAME depName , 
    	ENABLED enabled  , 
    	ACCOUNT_NON_EXPIRED accountNonExpired , 
    	ACCOUNT_NON_LOCKED accountNonLocked ,
    	CREDENTIALS_NON_EXPIRED credentialsNonExpired
	FROM SYS_USERS
		WHERE 1=1
		<include refid="queryUsersConditions"/>
		ORDER BY DT_CREATE DESC
		LIMIT #{startPage},#{pageSize}
		
    </select>
    
    
      <!-- 查询所有用户总数 -->
    <select id="queryUsersCount"  parameterType="com.saltedfish.cmd.admin.AdminListQueryCmd"  resultType="int">
		SELECT 
    	COUNT(USER_ID)
		FROM SYS_USERS
		WHERE 1=1
		<include refid="queryUsersConditions"/>
    </select>
    
   	 <!-- 添加管理员 -->
     <insert id="addAdminUser" parameterType="com.saltedfish.entity.security.SysUsers">
    	insert into SYS_USERS
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="username != null" >
        USER_NAME,
      </if>
      <if test="name != null" >
        NAME,
      </if>
      <if test="email != null" >
        EMAIL,
      </if>
      <if test="mobile != null" >
        MOBILE,
      </if>
      
       <if test="enabled != null" >
        ENABLED,
      </if>
      <if test="accountNonExpired != null" >
        ACCOUNT_NON_EXPIRED,
      </if>
      <if test="accountNonLocked != null" >
        ACCOUNT_NON_LOCKED,
      </if>
      <if test="credentialsNonExpired != null" >
        CREDENTIALS_NON_EXPIRED,
      </if>
      
        <if test="description != null" >
        DESCRIPTION,
      	</if>
        <if test="sex != null" >
        SEX,
      	</if>
        <if test="dtCreate != null" >
        DT_CREATE,
      	</if>
      
      <if test="password !=null">
      	PASSWORD,
      </if>
      
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="username != null" >
        #{username,jdbcType=VARCHAR},
      </if>
      <if test="name != null" >
        #{name,jdbcType=VARCHAR},
      </if>
      <if test="email != null" >
        #{email,jdbcType=VARCHAR},
      </if>
      <if test="mobile != null" >
        #{mobile,jdbcType=VARCHAR},
      </if>
      
      <if test="enabled != null" >
        #{enabled,jdbcType=INTEGER},
      </if>
      <if test="accountNonExpired != null" >
        #{accountNonExpired,jdbcType=INTEGER},
      </if>
      <if test="accountNonLocked != null" >
        #{accountNonLocked,jdbcType=INTEGER},
      </if>
      <if test="credentialsNonExpired != null" >
        #{credentialsNonExpired,jdbcType=INTEGER},
      </if>
      
      <if test="description != null" >
        #{description,jdbcType=VARCHAR},
      </if>
      <if test="sex != null" >
        #{sex,jdbcType=INTEGER},
      </if>
      <if test="dtCreate != null" >
        #{dtCreate,jdbcType=INTEGER},
      </if>
      <if test="password !=null">
       #{password,jdbcType=INTEGER},
      </if>
      
    </trim>
  </insert>
    
    
</mapper> 