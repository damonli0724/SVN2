<?xml version="1.0" encoding="UTF-8" ?>  
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
<mapper namespace="com.saltedfish.mapper.security.RoleMapper">

    
    <!-- 根据用户查询用户的角色 -->
    <select id="selectRolesByUserId" parameterType="String" resultType="com.saltedfish.entity.security.SysRoles">
    SELECT 
		roles.ROLE_ID roleId,
		roles.ROLE_NAME roleName,
		roles.ROLE_DESC roleDesc,
		roles.ENABLE enable,
		roles.ROLE_KEY roleKey
	FROM SYS_USERS_ROLES sur 
		LEFT JOIN  SYS_ROLES roles on roles.ROLE_ID = sur.ROLE_ID
		LEFT JOIN  SYS_USERS users on users.USER_ID  = sur.USER_ID
	WHERE users.USER_ID = #{value}
    </select>
    
    <!-- 查询所有角色 -->
    <select id="queryAllRoles" resultType="com.saltedfish.entity.security.SysRoles">
	    SELECT 
			roles.ROLE_ID roleId,
			roles.ROLE_NAME roleName,
			roles.ROLE_DESC roleDesc,
			roles.ENABLE enable,
			roles.ROLE_KEY roleKey
		FROM SYS_ROLES roles	
    </select>
    
    <!-- 添加角色 -->
    <insert id="addRole" parameterType="com.saltedfish.entity.security.SysRoles">
   	 	<selectKey resultType="java.lang.String" order="AFTER"
			keyProperty="roleId">
			SELECT LAST_INSERT_ID() AS roleId
		</selectKey>
    	INSERT INTO  SYS_ROLES(ROLE_NAME,ROLE_DESC,ENABLE) VALUES(#{roleName},#{roleDesc},#{enable})
    </insert>
    
    <!-- 添加角色资源关联表数据 -->
    <insert id="addRoleResRelation" parameterType="map">
    INSERT INTO SYS_ROLES_RESOURCES (RES_ID,ROLE_ID)  VALUES  (#{resId},#{roleId})
   
</insert>
    
</mapper> 